<h1 id="crossappboilerplateh5version">Cross App Boilerplate - H5 Version</h1>
<p>跨H5/小程序模板 - H5 版本，包含了以下内容：</p>
<ul>
<li><p>Redux Store:</p>
<ul>
<li>已经默认配置在配置到根节点</li>
<li>在 store/index 中扩展了 connect 方法，默认 mapDispatch 提供所有 actions.js 下的 exports 为 page 及 app 的参数 <code>actions</code>, 如 <code>page.props.actions</code>, <code>window.app.actions</code></li></ul></li>
<li><p>增强的 API:</p>
<ul>
<li>跨 weapp 的 Request API: <code>api/index</code></li>
<li>及 rest api: <code>api/rest</code>, 如：<code>rest(path).query(where) =&gt; promise</code></li>
<li>均自带了基础的错误处理，返回 Promise 协议</li></ul></li>
<li><p>增强的 <code>App.js</code>:</p>
<ul>
<li>已经配置了路由, 通过 <code>pages/index.js</code> 入口配置及访问;</li>
<li>实现了全局的 Modal 以及 Loading，并提供 <code>showModal</code>, <code>showLoading</code> 接口访问;</li>
<li>可选是否添加边栏</li></ul></li>
<li><p>增强的 Page props:</p>
<ul>
<li>在 <code>App.js</code> 中使用了增强了的路由 <code>SmartRoute</code>，使得 Page 自带以下 props 增强：</li>
<li><code>showModal</code>, <code>showLoading</code> 方法</li>
<li>react-intl 的 <code>intl</code> 对象</li>
<li>已经 bind 到 store 的全部 actions 对象</li>
<li>router 相关对象: <code>match</code>, <code>location</code>, <code>history</code> 等</li>
<li>自动获取当前 <code>query</code> 值(search query + hash query)传入到 page 中</li></ul></li>
<li><p>部分跨平台 HoC 封装: withForm / connect</p></li>
<li><p>部分较应用层的 components 及 containers 封装，Form / Table / RestTable 等, 见 Boilerplate 默认 DEMO 里的相关页面;</p></li>
<li><p>涵盖一些基础的测试可供参考, 见各目录下的 <code>*.test.js</code></p></li>
</ul>
<h2 id="installation">INSTALLATION</h2>
<ol>
<li>Copy 项目代码<ul>
<li>团队项目可直接参考 <code>apps/</code> 目录 copy 到相应子目录;</li></ul></li>
<li>修改 package.json 中相应内容: 项目名称、版本号等</li>
<li>更新 react-script 并清除 build warning</li>
<li>视情况删除 package.json make-readme 相关 script</li>
<li>视情况而定是否删除 App.js 中的 Sidebar</li>
</ol>
<h2 id="">基础设施</h2>
<ul>
<li>脚手架: <a href="https://github.com/facebookincubator/create-react-app">Create React App</a>. <a href="https://github.com/facebookincubator/create-react-app/blob/master/packages/react-scripts/template/README.md">Full Guide</a></li>
<li>框架: react^16.2, <a href="https://reacttraining.com/react-router/web/guides/philosophy">react-router-dom^4.2</a>,
<a href="https://redux.js.org">redux^3.7</a>, <a href="https://github.com/gaearon/redux-thunk">redux-thunk^2.2</a>,</li>
<li>I18n: <a href="https://github.com/yahoo/react-intl/">react-intl</a>; 图标: react-icons</li>
</ul>
<hr />
<h2 id="-1">目录结构</h2>
<ul>
<li>docs: 项目业务文档，如交互稿、 API 接口协议等</li>
<li>pages: 以页面为单位放置页面逻辑代码(与小程序一致化)</li>
<li>i18n: 多国语言处理</li>
<li>containers: 页面调用的业务代码，包括业务 container 与相应逻辑模块等</li>
<li>components: 业务无关组件及逻辑</li>
<li>libs: 外部组件</li>
<li>images: 图片资源</li>
<li>build: 打包后可发布的代码</li>
</ul>
<h2 id="-2">框架增强</h2>
<ul>
<li>redux actions binding: 已经在 store.actions 自动 bindActionCreators 处理了 <code>import * from stores/actions</code> 下的非 api 字段的实现，并且做了一层递归处理</li>
<li>AppRoute</li>
<li>AppModal<ul>
<li>app.showModal</li></ul></li>
<li>Loading 状态：
Example: <code>app.setLoading(showing: Boolean, config: Object { duration: Integer = 2000 })</code></li>
</ul>
<h2 id="-3">自主研发组件库：</h2>
<ul>
<li><code>components/withForm</code>: 参考 redux-form 协议的去 redux, react 的跨小程序实现表单库;</li>
<li class="task-list-item" style="list-style-type: none;"><input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"> SchemaForm: 参考 react-jsonschema-form 实现的协议化表单生成库的跨小程序 superset 实现</li>
<li class="task-list-item" style="list-style-type: none;"><input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"> Drawer: Material 风格侧边栏实现 for Admin Dashboard</li>
</ul>
<h2 id="-4">库引用及使用建议</h2>
<h3 id="polyfill">Polyfill:</h3>
<ul>
<li>es6-shim</li>
<li>promise-polyfill (如果想要支持 finally 语法的话需要重新定制)</li>
<li>create-react-app 已经自带的库: <a href="https://github.com/facebook/create-react-app/blob/master/packages/react-scripts/template/README.md#supported-language-features-and-polyfills">Link</a><ul>
<li>主要包含一部分的 ES6 内容, JSX, 以及 whatwg-fetch</li></ul></li>
</ul>
<h3 id="for">功能增强 for 跨小程序:</h3>
<p>可以在 libs/ 目录下找到</p>
<ul>
<li><a href="http://underscorejs.org/">underscore</a>: 建议取代 lodash，更小的体积更适合于移植到小程序;</li>
<li><a href="https://github.com/chriso/validator.js">validator</a>: 同于表单项以及通用的格式验证，如 isURL, isEmail 等;</li>
<li><a href="https://github.com/taylorhakes/fecha">fecha</a>: 日期格式化库
如 <code>fecha.format(new Date(2015, 10, 20), 'dddd MMMM Do, YYYY');</code></li>
<li><a href="https://date-fns.org/">date-fns</a>: 复杂日期处理，建议用于取代 moments 日期相关组件;</li>
<li><a href="https://github.com/mariocasciaro/object-path">object-path</a>: 用于 object deep operation
如 <code>objectPath.set(obj, "a.j.0.f", "m");</code></li>
</ul>
<h3 id="for-1">功能增强 for 小程序</h3>
<ul>
<li>material-design-icons-css</li>
<li>i18n/weapp/intl</li>
</ul>
<h3 id="react">React 专用功能增强:</h3>
<ul>
<li><a href="https://gorangajic.github.io/react-icons/">react-icons</a>: 在小程序中使用字体图表取代，更方便调用并且可以调整大小与颜色;</li>
<li><a href="https://github.com/yahoo/react-intl/">react-intl</a>: 作为 H5 使用的 i18n 库，并且使用其协议进行小程序的开发;</li>
</ul>
<h3 id="admin">Admin 可以考虑使用的增强库:</h3>
<ul>
<li>material-ui</li>
<li>react-jsonschema-form</li>
</ul>
<h3 id="-5">不再使用的库：</h3>
<ul>
<li>react-tap-event-plugin / fastclick: 新浏览器已经解决了这个问题</li>
</ul>
<h2 id="-6">测试</h2>
<p>主要使用 <a href="https://facebook.github.io/jest/">jest</a> &amp; <a href="http://airbnb.io/enzyme/">enzyme</a> 进行单元测试。调用 <code>npm test</code> 即可进行监听测试。</p>
<p>具体测试指引见 create-react-app 的相关文档<a href="https://github.com/facebook/create-react-app/blob/master/packages/react-scripts/template/README.md#running-tests">User Guide - Running Tests</a>。</p>
<p>不要求测试覆盖，但建议编写以下测试项:</p>
<ul>
<li>集成测试：参考 <code>App.test.js</code>, 通过 mock API 完成整站核心流程的测试，以及核心 Page 在 App 环境下的的交互测试；</li>
<li>逻辑模块测试：对重要的模型模块的逻辑进行测试驱动开发，保证修改逻辑不会影响到测试项；</li>
<li>redux 测试：对 store 的生成、重要的 redux actions 及其对 state 的操作结果进行测试；</li>
<li>测试驱动开发：逻辑较为复杂的模型或者组件建议使用测试驱动开发，保证代码的可测试型，方便维护与调试；</li>
</ul>
<h2 id="-7">思路</h2>
<ul>
<li>重新思考 Boilerplate 及 App 的定位</li>
<li>以 Page 为单位管理页面，整体层级为 App -&gt; Page -&gt; [HoC]Containers -&gt; Components, 其中 App 提供框架， 大多数 connect 行为发生在 page 上，Components 不调用 actions</li>
<li>添加一部分命令式调用方法以加速开发: 添加在 console 命令式调用的能力</li>
<li>语义化与标准协议的新含义：基于协议的工具。如 react-jsonschema-form, bootstrap 的 DOM 风格等</li>
</ul>
<h2 id="todo">TODO</h2>
<ul>
<li class="task-list-item" style="list-style-type: none;"><input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"> 给 Portal 增加 Installation 指引以及 Git 链接</li>
<li class="task-list-item" style="list-style-type: none;"><input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"> showToast API</li>
<li class="task-list-item" style="list-style-type: none;"><input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"> 去除对 react-weui 的依赖<ul>
<li class="task-list-item" style="list-style-type: none;"><input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;" checked> 初步先改为模块化依赖</li></ul></li>
<li class="task-list-item" style="list-style-type: none;"><input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"> 完善 Theme 的支持, 界面添加切换 dark theme</li>
<li class="task-list-item" style="list-style-type: none;"><input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"> 部署到 demo.ibg.com 提供体验</li>
<li class="task-list-item" style="list-style-type: none;"><input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"> Drawer 接入优化</li>
<li class="task-list-item" style="list-style-type: none;"><input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;" checked> 添加 scss watch 到 npm start</li>
<li class="task-list-item" style="list-style-type: none;"><input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;" checked> 完善 UI 数据组件页面</li>
<li class="task-list-item" style="list-style-type: none;"><input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;" checked> 完善 Schema 表单组件页面<ul>
<li class="task-list-item" style="list-style-type: none;"><input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;" checked> withForm 注释文档补充</li>
<li class="task-list-item" style="list-style-type: none;"><input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;" checked> SchemaForm 注释文档补充</li>
<li>showSchemaForm API 说明</li></ul></li>
<li class="task-list-item" style="list-style-type: none;"><input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;" checked> RESTful 示例</li>
</ul>